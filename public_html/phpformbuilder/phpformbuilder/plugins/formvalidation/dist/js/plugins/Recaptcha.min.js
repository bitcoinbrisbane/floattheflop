!function(e,t){typeof exports==='object'&&typeof module!=='undefined'?module.exports=t():typeof define==='function'&&define.amd?define(t):(e.FormValidation=e.FormValidation||{}, e.FormValidation.plugins=e.FormValidation.plugins||{}, e.FormValidation.plugins.Recaptcha=t())}(this,(function(){"use strict";var e=FormValidation.Plugin,t;!function(e){e.Ignored="Ignored";e.Invalid="Invalid";e.NotValidated="NotValidated";e.Valid="Valid";e.Validating="Validating"}(t||(t={}));var a=t,i=FormValidation.utils.fetch,n=function(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}},r=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1;i.configurable=!0;"value" in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,a,i){a&&e(t.prototype,a);i&&e(t,i);return t}}(),o=function(e,t,a){t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):(e[t]=a);return e},c=function(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},l=function(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e},s=function(e){c(t,e);function t(e){n(this,t);var i=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i.widgetIds=new Map;i.captchaStatus=a.NotValidated;i.opts=Object.assign({},t.DEFAULT_OPTIONS,e);i.fieldResetHandler=i.onResetField.bind(i);i.preValidateFilter=i.preValidate.bind(i);return i}r(t,[{key:'install',value:function(){var e=this;this.core.on('core.field.reset',this.fieldResetHandler).registerFilter('validate-pre',this.preValidateFilter);var n=typeof window[t.LOADED_CALLBACK]==='undefined'?function(){}:window[t.LOADED_CALLBACK];window[t.LOADED_CALLBACK]=function(){n();var r={'badge':e.opts.badge,'callback':function(){e.opts.backendVerificationUrl===''&&(e.captchaStatus=a.Valid,e.core.updateFieldStatus(t.CAPTCHA_FIELD,a.Valid))},'error-callback':function(){e.captchaStatus=a.Invalid;e.core.updateFieldStatus(t.CAPTCHA_FIELD,a.Invalid)},'expired-callback':function(){e.captchaStatus=a.NotValidated;e.core.updateFieldStatus(t.CAPTCHA_FIELD,a.NotValidated)},'sitekey':e.opts.siteKey,'size':e.opts.size},c=window.grecaptcha.render(e.opts.element,r);e.widgetIds.set(e.opts.element,c);e.core.addField(t.CAPTCHA_FIELD,{validators:{promise:{message:e.opts.message,promise:function(n){if(n.value===''){e.captchaStatus=a.Invalid;return Promise.resolve({valid:!1})}else if(e.opts.backendVerificationUrl===''){e.captchaStatus=a.Valid;return Promise.resolve({valid:!0})}else if(e.captchaStatus===a.Valid){return Promise.resolve({valid:!0})}else{return i(e.opts.backendVerificationUrl,{method:'POST',params:o({},t.CAPTCHA_FIELD,n.value)}).then(function(t){var i=''+t.success==='true';e.captchaStatus=i?a.Valid:a.Invalid;return Promise.resolve({meta:t,valid:i})}).catch(function(t){e.captchaStatus=a.NotValidated;return Promise.reject({valid:!1})})}}}}})};var r=this.getScript();if(!document.body.querySelector('script[src="'+r+'"]')){var c=document.createElement('script');c.type='text/javascript';c.async=!0;c.defer=!0;c.src=r;document.body.appendChild(c)}}},{key:'uninstall',value:function(){this.timer&&clearTimeout(this.timer);this.core.off('core.field.reset',this.fieldResetHandler).deregisterFilter('validate-pre',this.preValidateFilter);this.widgetIds.clear();var e=this.getScript(),a=[].slice.call(document.body.querySelectorAll('script[src="'+e+'"]'));a.forEach(function(e){return e.parentNode.removeChild(e)});this.core.removeField(t.CAPTCHA_FIELD)}},{key:'getScript',value:function(){var e=this.opts.language?'&hl='+this.opts.language:'';return'https://www.google.com/recaptcha/api.js?onload='+t.LOADED_CALLBACK+'&render=explicit'+e}},{key:'preValidate',value:function(){var e=this;if(this.opts.size==='invisible'&&this.widgetIds.has(this.opts.element)){var t=this.widgetIds.get(this.opts.element);return this.captchaStatus===a.Valid?Promise.resolve():new Promise(function(a,i){window.grecaptcha.execute(t).then(function(){e.timer&&clearTimeout(e.timer);e.timer=window.setTimeout(a,1e3)})})}else{return Promise.resolve()}}},{key:'onResetField',value:function(e){if(e.field===t.CAPTCHA_FIELD&&this.widgetIds.has(this.opts.element)){var a=this.widgetIds.get(this.opts.element);window.grecaptcha.reset(a)}}}]);return t}(e);s.CAPTCHA_FIELD='g-recaptcha-response';s.DEFAULT_OPTIONS={backendVerificationUrl:'',badge:'bottomright',size:'normal',theme:'light'};s.LOADED_CALLBACK='___reCaptchaLoaded___';return s}))