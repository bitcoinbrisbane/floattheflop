!function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){var n;return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){class fileTree{constructor(targetId,options={}){this.listeningFolders=[],this.template=null,this.treeMarkup="",this.targetId=targetId;const defaults={connector:"php",dragAndDrop:!0,explorerMode:"list",extensions:[".*"],loadFolder:!0,mainDir:"demo-files",maxDeph:3,modeSwitcher:!0,cancelBtn:!0,okBtn:!0,template:"bootstrap4",elementClick:function(filePath,fileName,e){console.log(filePath),console.log(fileName)},cancelBtnClick:function(){console.log("Cancel")},okBtnClick:function(filePath,fileName){console.log(filePath),console.log(fileName)},callback:()=>{}};this.options=Object.assign({},defaults,options),this.icons={archive:"ft-icon-file-zip",excel:"ft-icon-file-excel",folder:"ft-icon-folder",folderOpen:"ft-icon-folder-open",html:"ft-icon-html-five2",image:"ft-icon-file-picture",music:"ft-icon-file-music",openoffice:"ft-icon-file-openoffice",pdf:"ft-icon-file-pdf",text:"ft-icon-file-text2",video:"ft-icon-file-video",word:"ft-icon-file-word",default:"ft-icon-file-empty"},this.foldersContent=new Array,this.fileTypes=Object.keys(this.icons),this.extTypes={archive:["7z","7-Zip","arj","deb","pkg","rar","rpm","tar.gz","z","zip"],excel:["xls","xlsx"],html:["htm","html"],image:["bmp","gif","jpg","jpeg","png","svg","tif","tiff","webp"],music:["aif","mp3","mpa","ogg","wav","wma"],openoffice:["odt","ott","odm","ods","ots","odg","otg","odp","otp","odf","odc","odb"],pdf:["pdf"],text:["rtf","tex","txt"],video:["3g2","3gp","avi","flv","h264","m4v","mkv","mov","mp4","mpg","rm","swf","vob","wmv"],word:["doc","docx"]},this.scriptSrc=this.getScriptScr(),this.getFiles().then(data=>{if(this.jsonTree=JSON.parse(data),this.jsonTree.error)throw this.jsonTree.error;this.buildTree(),!0===this.options.dragAndDrop?("undefined"==typeof CryptoJS&&this.loadScript(this.scriptSrc+"lib/crypto-js/crypto-js.min.js"),"undefined"==typeof sortable?this.loadScript(this.scriptSrc+"lib/html5sortable/html5sortable.min.js").then(()=>{this.render()}).catch(()=>{console.error("Script loading failed :( ")}):this.render()):this.render()}).catch(err=>{console.error("Augh, there was an error!",err)})}render(){const $targetId=document.getElementById(this.targetId);this.loadCss(),$targetId.querySelectorAll(".ft-tree")[0].innerHTML=this.treeMarkup;const folders=$targetId.querySelectorAll(".ft-tree .ft-folder-container");Array.prototype.forEach.call(folders,(el,i)=>{el.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const parents=this.parentsUntil(el,"ft-folder-container","ft-"+this.targetId+"-root");return Array.prototype.forEach.call(folders,(folder,i)=>{const ic=folder.querySelector("i");parents.indexOf(folder)>-1?(folder.classList.add("ft-folder-open"),ic.classList.remove(this.icons.folder),ic.classList.add(this.icons.folderOpen)):(folder.classList.remove("ft-folder-open"),ic.classList.add(this.icons.folder),ic.classList.remove(this.icons.folderOpen))}),this.currentFolderId=el.getAttribute("id"),!0===this.options.loadFolder&&this.loadFolder(this.currentFolderId),!1})}),this.currentFolderId="ft-"+this.targetId+"-root",!0===this.options.loadFolder&&this.loadFolder(this.currentFolderId),this.options.callback()}loadCss(){const ftIcons=document.getElementById("ft-icons");if(null==ftIcons){const linkElement=document.createElement("link");linkElement.setAttribute("id","ft-icons"),linkElement.setAttribute("rel","stylesheet"),linkElement.setAttribute("type","text/css"),linkElement.setAttribute("href",this.scriptSrc+"icons/style.css"),document.getElementsByTagName("head")[0].appendChild(linkElement)}const ftCss=document.getElementById("ft-styles");if(null==ftCss){const linkElement=document.createElement("link");linkElement.setAttribute("id","ft-styles"),linkElement.setAttribute("rel","stylesheet"),linkElement.setAttribute("type","text/css"),linkElement.setAttribute("href",this.scriptSrc+"templates/"+this.options.template+".css"),document.getElementsByTagName("head")[0].appendChild(linkElement)}}loadScript(src){var script=document.createElement("script");return script.setAttribute("src",src),document.body.appendChild(script),new Promise((res,rej)=>{script.onload=function(){res()},script.onerror=function(){rej()}})}buildFolderContent(jst=this.jsonTree,url,deph){const folderContent={folders:[],files:[]};for(let key in jst){let value=jst[key];if(isNaN(parseInt(key))){let data=jst[key];folderContent.folders.push({parent:data.parent,dataRefId:key+"-"+(deph+1).toString(),name:key,url:url+key+"/"})}else{const filedata=value;Object.assign(filedata,{type:this.getFileType(filedata.ext)});const icon=this.icons[filedata.type];"image"===filedata.type?folderContent.files.push({name:filedata.name,icon:icon,type:filedata.type,url:url+filedata.name,width:null,height:null}):folderContent.files.push({name:filedata.name,icon:icon,size:filedata.size,type:filedata.type,url:url+filedata.name})}}return folderContent}buildTree(jst=this.jsonTree,url=this.options.mainDir+"/",deph=0){if(0===deph){const rootId="ft-"+this.targetId+"-root";this.treeMarkup=`<ul class="ft-tree"><li id="${rootId}" class="ft-folder-container ft-folder-open"><div><i class="${this.icons.folderOpen}"></i><a href="#" data-url="${url}">root</a></div>`,this.foldersContent[rootId]=this.buildFolderContent(this.jsonTree,url,deph),deph+=1}for(let key in jst){let jsonSubTree=jst[key];if(isNaN(parseInt(key))){const folderId=key+"-"+deph.toString();this.foldersContent[folderId]=this.buildFolderContent(jsonSubTree,url+key+"/",deph),this.treeMarkup+=`<ul><li id="${folderId}" class="ft-folder-container"><div><i class="${this.icons.folder}"></i><a href="#" data-url="${url+key}">${key}</a></div>`,deph<this.options.maxDeph&&this.buildTree(jsonSubTree,url+key+"/",deph+1),this.treeMarkup+="</li></ul>"}}0===deph&&(this.treeMarkup+="</li></ul>")}enableDrag(){let explorerContainerSelector=".ft-explorer-list-container";"grid"===this.options.explorerMode&&(explorerContainerSelector=".ft-explorer-grid-container");let folders=document.getElementById(this.targetId).querySelectorAll(".ft-folder-container");sortable(explorerContainerSelector,{items:".ft-file-container",acceptFrom:!1}),folders.forEach(folder=>{const folderId=folder.getAttribute("id");-1===this.listeningFolders.indexOf(folderId)||folderId.match(/^explorer-/)?folderId!==this.currentFolderId&&(sortable("#"+folderId,{acceptFrom:".ft-explorer-list-container, .ft-explorer-grid-container"}),this.listeningFolders.push(folderId),sortable("#"+folderId)[0].addEventListener("sortupdate",this.moveFile.bind(this))):folderId===this.currentFolderId?sortable("#"+folderId,"disable"):sortable("#"+folderId,"enable")})}moveFile(e){for(let index=0;index<e.detail.item.children.length;index++){const element=e.detail.item.children[index];if(void 0!==element.dataset.filename&&void 0!==element.dataset.href){const salt="%t$qPP",filehash=encodeURIComponent(CryptoJS.SHA256(element.dataset.href+salt).toString()),filename=encodeURIComponent(element.dataset.filename),filepath=encodeURIComponent(element.dataset.href),ext=encodeURIComponent(JSON.stringify(this.options.extensions));let destpath=this.options.mainDir;if(e.detail.destination.container.id!=="ft-"+this.targetId+"-root"&&(destpath=document.getElementById(e.detail.destination.container.id.replace(/^explorer-/,"")).querySelector('div[draggable="true"] > a').getAttribute("data-url")),destpath+="/"+element.dataset.filename,destpath=encodeURIComponent(destpath),destpath!==filepath){const data=`filename=${filename}&filepath=${filepath}&destpath=${destpath}&filehash=${filehash}&ext=${ext}`;index=e.detail.item.children.length-1;var request=new XMLHttpRequest;request.open("POST",this.scriptSrc+"ajax/move-file.php",!0),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.onload=()=>{if(request.status>=200&&request.status<400){var resp=JSON.parse(request.response);if("success"===resp.status){const container=document.getElementById(e.detail.destination.container.id),itemIndex=e.detail.destination.index;container.children[itemIndex].parentNode.removeChild(container.children[itemIndex]),this.getFiles().then(data=>{if(this.jsonTree=JSON.parse(data),this.jsonTree.error)throw this.jsonTree.error;this.buildTree()}).catch(err=>{console.error("Augh, there was an error!",err)})}else console.error(resp)}else console.error("Ajax query failed")},request.onerror=function(){console.error("There was a connection error of some sort")},request.send(data)}}}}getFileType(ext){const x=this.extTypes;for(let key in x){let value;if(-1!==x[key].indexOf(ext))return key}return"default"}getFiles(){return new Promise((resolve,reject)=>{let xhr=new XMLHttpRequest;xhr.open("POST",this.scriptSrc+"connectors/connector."+this.options.connector,!0),xhr.onload=function(){this.status>=200&&this.status<300?resolve(xhr.response):reject({status:this.status,statusText:xhr.statusText})},xhr.onerror=function(){reject({status:this.status,statusText:xhr.statusText})},xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),xhr.send("dir="+encodeURI(this.options.mainDir)+"&ext="+JSON.stringify(this.options.extensions))})}getScriptScr(){const sc=document.getElementsByTagName("script");for(let idx=0;idx<sc.length;idx++){const s=sc.item(idx);if(s.src&&s.src.match(/file-tree(\.min)?\.js$/))return s.src.replace(/js\/file-tree(\.min)?\.js$/,"")}}humanFileSize(bytes,si){var thresh=si?1e3:1024;if(Math.abs(bytes)<thresh)return bytes+" B";var units=si?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],u=-1;do{bytes/=thresh,++u}while(Math.abs(bytes)>=thresh&&u<units.length-1);return bytes.toFixed(1)+" "+units[u]}loadFolder(folderId){const $targetId=document.getElementById(this.targetId),folderContent=this.foldersContent[folderId];let clone,output;this.loadTemplates().then(template=>{this.template=template;const folders=folderContent.folders,files=folderContent.files;let explorerContainer,explorerFile,explorerFolder,explorerImage,explorerActionBtns,explorerMode,explorerModeClone;explorerActionBtns=document.querySelector("#explorer-action-btns");const explorerActionBtnsClone=explorerActionBtns.content.cloneNode(!0);switch(!0===this.options.modeSwitcher&&(explorerMode=document.querySelector("#explorer-mode"),explorerModeClone=explorerMode.content.cloneNode(!0)),this.options.explorerMode){case"list":explorerContainer=document.querySelector("#explorer-list"),explorerFile=document.querySelector("#explorer-list-file"),explorerFolder=document.querySelector("#explorer-list-folder"),explorerImage=document.querySelector("#explorer-list-image"),output=explorerContainer.content.querySelector(".ft-explorer-list-container").cloneNode(!0);break;case"grid":explorerContainer=document.querySelector("#explorer-grid"),explorerFile=document.querySelector("#explorer-grid-file"),explorerFolder=document.querySelector("#explorer-grid-folder"),explorerImage=document.querySelector("#explorer-grid-image"),output=explorerContainer.content.querySelector(".ft-explorer-grid-container").cloneNode(!0)}for(let key in folders){let folder=folders[key];clone=explorerFolder.content.cloneNode(!0),clone.querySelector("li").setAttribute("id","explorer-"+folder.dataRefId),clone.querySelector(".ft-folder").setAttribute("data-href",folder.dataRefId),clone.querySelector(".ft-folder i").classList.add(this.icons.folder),clone.querySelector(".ft-foldername").innerHTML=folder.name,output.appendChild(clone)}for(let key in files){let file=files[key];if("image"===file.type){let cloneId=Math.random().toString(36).substr(2,9);clone=explorerImage.content.cloneNode(!0),clone.querySelector(".ft-imagedesc").setAttribute("id",cloneId),clone.querySelector(".ft-image").setAttribute("data-href",file.url),clone.querySelector(".ft-image").setAttribute("data-filename",file.name),clone.querySelector(".ft-image img").setAttribute("src",file.url),clone.querySelector(".ft-imagename").innerHTML=file.name,output.appendChild(clone);let img=new Image;img.src=file.url,img.onload=()=>{let el;document.getElementById(cloneId).querySelector(".ft-image-size").innerHTML=img.width.toString()+"x"+img.height.toString()+"px"}}else clone=explorerFile.content.cloneNode(!0),clone.querySelector(".ft-file").setAttribute("data-href",file.url),clone.querySelector(".ft-file").setAttribute("data-filename",file.name),clone.querySelector(".ft-delete-file").setAttribute("data-href",file.url),clone.querySelector(".ft-delete-file").setAttribute("data-filename",file.name),clone.querySelector(".ft-file i").classList.add(file.icon),clone.querySelector(".ft-filename").innerHTML=file.name,clone.querySelector(".ft-filesize").innerHTML=this.humanFileSize(file.size,!0),output.appendChild(clone)}if($targetId.querySelector(".ft-explorer").innerHTML="",!0===this.options.modeSwitcher){$targetId.querySelector(".ft-explorer").appendChild(explorerModeClone);const modeBtns=Array.from($targetId.querySelectorAll(".ft-explorer-mode .explorer-mode-btn"));modeBtns.forEach(m=>{m.getAttribute("value")===this.options.explorerMode&&m.classList.add("active"),m.addEventListener("click",e=>{this.switchMode(),this.loadFolder(folderId)})})}$targetId.querySelector(".ft-explorer").appendChild(output),!0!==this.options.okBtn&&!0!==this.options.cancelBtn||($targetId.querySelector(".ft-explorer").appendChild(explorerActionBtnsClone),!0!==this.options.okBtn&&$targetId.querySelector(".explorer-ok-btn").remove(),!0!==this.options.cancelBtn&&$targetId.querySelector(".explorer-cancel-btn").remove(),!0===this.options.okBtn&&$targetId.querySelector(".explorer-ok-btn").addEventListener("click",e=>{e.preventDefault();const target=$targetId.querySelector(".ft-file-container.active a");if(null!==target){const targetFilename=target.getAttribute("data-filename"),targetHref=target.getAttribute("data-href");this.options.okBtnClick(targetHref,targetFilename)}else alert("Nothing selected");return!1},!1),!0===this.options.cancelBtn&&$targetId.querySelector(".explorer-cancel-btn").addEventListener("click",e=>(e.preventDefault(),this.options.cancelBtnClick(),!1),!1));const elements=Array.from($targetId.querySelectorAll(".ft-explorer a[data-href]")),elementContainers=Array.from($targetId.querySelectorAll(".ft-explorer .ft-file-container"));elements.forEach(el=>{el.addEventListener("click",e=>{e.preventDefault(),elementContainers.forEach(elContainer=>{elContainer.classList.remove("active")});const target=e.target.closest("a");if(null!==target.closest(".ft-file-container")){target.closest(".ft-file-container").classList.add("active");const targetFilename=target.getAttribute("data-filename"),targetHref=target.getAttribute("data-href");this.options.elementClick(targetHref,targetFilename,e)}return!1},!1)});const links=Array.from($targetId.querySelectorAll(".ft-explorer a.ft-folder"));links.forEach(l=>{l.addEventListener("click",e=>{e.preventDefault();const target=e.target.closest("a"),targetId=target.getAttribute("data-href");if(null!==targetId){var event=document.createEvent("HTMLEvents");event.initEvent("click",!0,!1),document.getElementById(targetId).dispatchEvent(event)}return!1},!1)}),!0===this.options.dragAndDrop&&this.enableDrag()}).catch(err=>{console.error("Augh, there was an error!",err)})}loadTemplates(){return new Promise((resolve,reject)=>{if(null!==this.template)resolve(this.template);else{const ftMode=this.options.explorerMode;let xhr=new XMLHttpRequest;xhr.open("GET",this.scriptSrc+"templates/"+this.options.template+".html",!0),xhr.onload=function(){if(this.status>=200&&this.status<300){if(document.querySelectorAll("#explorer-"+ftMode).length<1){const div=document.createElement("div");for(div.innerHTML=xhr.response;div.children.length>0;)document.body.appendChild(div.children[0])}resolve(xhr.response)}else reject({status:this.status,statusText:xhr.statusText})},xhr.onerror=function(){reject({status:this.status,statusText:xhr.statusText})},xhr.send()}})}parentsUntil(el,searchClass,stopElementId){const Parents=new Array;for(;el.parentNode;)if(el.classList.contains(searchClass)&&Parents.push(el),(el=el.parentNode).id===stopElementId)return Parents.push(el),Parents;return Parents}switchMode(){"list"===this.options.explorerMode?this.options.explorerMode="grid":this.options.explorerMode="list";for(let index=0;index<this.listeningFolders.length;index++)this.listeningFolders[index].match(/^explorer-/)&&this.listeningFolders.splice(index,1)}}Object.assign(window,{fileTree:fileTree})},{}]},{},[1]);